<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maria Paula Ibarcena Woll">

<title>SEIR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SEIR MODEL_files/libs/clipboard/clipboard.min.js"></script>
<script src="SEIR MODEL_files/libs/quarto-html/quarto.js"></script>
<script src="SEIR MODEL_files/libs/quarto-html/popper.min.js"></script>
<script src="SEIR MODEL_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SEIR MODEL_files/libs/quarto-html/anchor.min.js"></script>
<link href="SEIR MODEL_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SEIR MODEL_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SEIR MODEL_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SEIR MODEL_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SEIR MODEL_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SEIR</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maria Paula Ibarcena Woll </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(deSolve)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr   1.1.4     ✔ stringr 1.5.1
✔ forcats 1.0.0     ✔ tibble  3.2.1
✔ purrr   1.0.2     ✔ tidyr   1.3.1
✔ readr   2.1.5     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter()     masks plotly::filter(), stats::filter()
✖ dplyr::group_rows() masks kableExtra::group_rows()
✖ dplyr::lag()        masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rff <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Users/maria/OneDrive/Documents/GitHub/EPI-569-Final-Project/data/rff_2024.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clean-data-names" class="level2">
<h2 class="anchored" data-anchor-id="clean-data-names">Clean Data Names</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rff <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(rff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Initial Data Exploration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Examine Data Structure</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(rff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [91 × 34] (S3: tbl_df/tbl/data.frame)
 $ case_id                                                    : num [1:91] 1 2 3 4 5 6 7 8 9 10 ...
 $ infectedby                                                 : num [1:91] NA 1 1 2 2 5 5 5 7 7 ...
 $ gender                                                     : chr [1:91] "Female" "Male" "Male" "Male" ...
 $ course                                                     : chr [1:91] "EPI 569 (Concepts and Methods in ID EPI)" "EPI 569 (Concepts and Methods in ID EPI)" "EPI 569 (Concepts and Methods in ID EPI)" "EPI 569 (Concepts and Methods in ID EPI)" ...
 $ if_you_are_in_epi_569_which_ta_group_are_you_in            : chr [1:91] "Jessica Rothman" "Jessica Rothman" "Jessica Rothman" "Jessica Rothman" ...
 $ date_of_exposure                                           : Date[1:91], format: "2024-09-09" "2024-09-10" ...
 $ time_of_exposure                                           : chr [1:91] "09:30:00" "11:50:00" "12:45:00" "10:46:00" ...
 $ date_of_onset                                              : Date[1:91], format: "2024-09-09" "2024-09-11" ...
 $ date_time_onset                                            : chr [1:91] "2024-09-09 15:00:00" "2024-09-11 00:00:00" NA "2024-09-13 02:00:00" ...
 $ date_time_exposure                                         : chr [1:91] "2024-09-09 09:30:00" "2024-09-10 11:50:00" "2024-09-10 12:45:00" "2024-09-12 10:46:00" ...
 $ did_you_have_symptoms                                      : chr [1:91] "Yes" "Yes" "No" "Yes" ...
 $ how_many_hours_after_exposure_did_you_develop_symptoms     : num [1:91] 15 24 NA 26 21 22 17 NA 26 NA ...
 $ how_many_hours_after_your_symptom_onset_did_you_feel_better: num [1:91] 23 24 24 33 23 19 26 NA 24 NA ...
 $ date_time_recovery                                         : POSIXct[1:91], format: "2024-09-10 14:00:00" "2024-09-13 00:00:00" ...
 $ date_of_recovery                                           : Date[1:91], format: "2024-09-10" "2024-09-13" ...
 $ severe                                                     : chr [1:91] "Yes" "No" NA "Yes" ...
 $ date_became_severe                                         : Date[1:91], format: "2024-09-09" NA ...
 $ how_many_people_did_you_expose                             : num [1:91] 3 2 1 5 3 3 2 2 4 1 ...
 $ how_many_people_did_you_infect                             : num [1:91] 3 2 0 3 3 3 2 1 4 1 ...
 $ date_of_first_exposure                                     : Date[1:91], format: "2024-09-10" "2024-09-12" ...
 $ time_of_first_exposure                                     : chr [1:91] "11:45:00" "10:46:00" "11:05:00" "11:09:00" ...
 $ date_of_second_exposure                                    : Date[1:91], format: "2024-09-11" "2024-09-12" ...
 $ time_of_second_exposure                                    : chr [1:91] "10:00:00" "10:47:00" NA "11:09:00" ...
 $ date_of_third_exposure                                     : Date[1:91], format: "2024-09-13" NA ...
 $ time_of_third_exposure                                     : chr [1:91] "13:00:00" NA NA "11:09:00" ...
 $ date_of_fourth_exposure                                    : Date[1:91], format: NA NA ...
 $ time_of_fourth_exposure                                    : chr [1:91] NA NA NA "11:09:00" ...
 $ date_of_fifth_exposure                                     : Date[1:91], format: NA NA ...
 $ time_of_fifth_exposure                                     : chr [1:91] NA NA NA "11:09:00" ...
 $ date_time_first_exposure                                   : chr [1:91] "2024-09-10 11:45:00" "2024-09-12 10:46:00" "2024-09-16 11:05:00" "2024-09-30 11:09:00" ...
 $ date_time_second_exposure                                  : chr [1:91] "2024-09-11 10:00:00" "2024-09-12 10:47:00" NA "2024-09-30 11:09:00" ...
 $ date_time_third_exposure                                   : chr [1:91] "2024-09-13 13:00:00" NA NA "2024-09-30 11:09:00" ...
 $ date_time_fourth_exposure                                  : chr [1:91] NA NA NA "2024-09-30 11:09:00" ...
 $ date_time_fifth_exposure                                   : chr [1:91] NA NA NA "2024-09-30 11:09:00" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Examine First Few Rows of Data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 34
  case_id infectedby gender course       if_you_are_in_epi_56…¹ date_of_exposure
    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;                  &lt;date&gt;          
1       1         NA Female EPI 569 (Co… Jessica Rothman        2024-09-09      
2       2          1 Male   EPI 569 (Co… Jessica Rothman        2024-09-10      
3       3          1 Male   EPI 569 (Co… Jessica Rothman        2024-09-10      
4       4          2 Male   EPI 569 (Co… Jessica Rothman        2024-09-12      
5       5          2 Female EPI 569 (Co… Sara Kim               2024-09-12      
6       6          5 Female EPI 569 (Co… Charlotte Doran        2024-09-12      
# ℹ abbreviated name: ¹​if_you_are_in_epi_569_which_ta_group_are_you_in
# ℹ 28 more variables: time_of_exposure &lt;chr&gt;, date_of_onset &lt;date&gt;,
#   date_time_onset &lt;chr&gt;, date_time_exposure &lt;chr&gt;,
#   did_you_have_symptoms &lt;chr&gt;,
#   how_many_hours_after_exposure_did_you_develop_symptoms &lt;dbl&gt;,
#   how_many_hours_after_your_symptom_onset_did_you_feel_better &lt;dbl&gt;,
#   date_time_recovery &lt;dttm&gt;, date_of_recovery &lt;date&gt;, severe &lt;chr&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check for Missing Values</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(rff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    case_id 
                                                          0 
                                                 infectedby 
                                                          1 
                                                     gender 
                                                         18 
                                                     course 
                                                         18 
            if_you_are_in_epi_569_which_ta_group_are_you_in 
                                                         49 
                                           date_of_exposure 
                                                          0 
                                           time_of_exposure 
                                                          0 
                                              date_of_onset 
                                                         35 
                                            date_time_onset 
                                                         35 
                                         date_time_exposure 
                                                          0 
                                      did_you_have_symptoms 
                                                         18 
     how_many_hours_after_exposure_did_you_develop_symptoms 
                                                         35 
how_many_hours_after_your_symptom_onset_did_you_feel_better 
                                                         34 
                                         date_time_recovery 
                                                         35 
                                           date_of_recovery 
                                                         35 
                                                     severe 
                                                         36 
                                         date_became_severe 
                                                         61 
                             how_many_people_did_you_expose 
                                                         18 
                             how_many_people_did_you_infect 
                                                          0 
                                     date_of_first_exposure 
                                                         23 
                                     time_of_first_exposure 
                                                         23 
                                    date_of_second_exposure 
                                                         47 
                                    time_of_second_exposure 
                                                         46 
                                     date_of_third_exposure 
                                                         68 
                                     time_of_third_exposure 
                                                         68 
                                    date_of_fourth_exposure 
                                                         79 
                                    time_of_fourth_exposure 
                                                         79 
                                     date_of_fifth_exposure 
                                                         87 
                                     time_of_fifth_exposure 
                                                         87 
                                   date_time_first_exposure 
                                                         23 
                                  date_time_second_exposure 
                                                         47 
                                   date_time_third_exposure 
                                                         68 
                                  date_time_fourth_exposure 
                                                         79 
                                   date_time_fifth_exposure 
                                                         87 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary of Data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    case_id       infectedby       gender             course         
 Min.   : 1.0   Min.   : 1.00   Length:91          Length:91         
 1st Qu.:23.5   1st Qu.:11.25   Class :character   Class :character  
 Median :46.0   Median :36.50   Mode  :character   Mode  :character  
 Mean   :46.0   Mean   :34.21                                        
 3rd Qu.:68.5   3rd Qu.:52.50                                        
 Max.   :91.0   Max.   :71.00                                        
                NA's   :1                                            
 if_you_are_in_epi_569_which_ta_group_are_you_in date_of_exposure    
 Length:91                                       Min.   :2024-09-09  
 Class :character                                1st Qu.:2024-09-20  
 Mode  :character                                Median :2024-09-28  
                                                 Mean   :2024-09-25  
                                                 3rd Qu.:2024-10-02  
                                                 Max.   :2024-10-16  
                                                                     
 time_of_exposure   date_of_onset        date_time_onset    date_time_exposure
 Length:91          Min.   :2024-09-09   Length:91          Length:91         
 Class :character   1st Qu.:2024-09-20   Class :character   Class :character  
 Mode  :character   Median :2024-09-25   Mode  :character   Mode  :character  
                    Mean   :2024-09-25                                        
                    3rd Qu.:2024-10-02                                        
                    Max.   :2024-10-12                                        
                    NA's   :35                                                
 did_you_have_symptoms how_many_hours_after_exposure_did_you_develop_symptoms
 Length:91             Min.   :13.00                                         
 Class :character      1st Qu.:21.00                                         
 Mode  :character      Median :24.00                                         
                       Mean   :24.68                                         
                       3rd Qu.:29.00                                         
                       Max.   :35.00                                         
                       NA's   :35                                            
 how_many_hours_after_your_symptom_onset_did_you_feel_better
 Min.   :12.00                                              
 1st Qu.:23.00                                              
 Median :26.00                                              
 Mean   :26.11                                              
 3rd Qu.:32.00                                              
 Max.   :48.00                                              
 NA's   :34                                                 
 date_time_recovery            date_of_recovery        severe         
 Min.   :2024-09-10 14:00:00   Min.   :2024-09-10   Length:91         
 1st Qu.:2024-09-21 06:30:00   1st Qu.:2024-09-21   Class :character  
 Median :2024-09-27 18:30:00   Median :2024-09-27   Mode  :character  
 Mean   :2024-09-27 09:15:00   Mean   :2024-09-26                     
 3rd Qu.:2024-10-04 11:15:00   3rd Qu.:2024-10-04                     
 Max.   :2024-10-14 09:00:00   Max.   :2024-10-14                     
 NA's   :35                    NA's   :35                             
 date_became_severe   how_many_people_did_you_expose
 Min.   :2024-09-09   Min.   :0.000                 
 1st Qu.:2024-09-17   1st Qu.:1.000                 
 Median :2024-09-24   Median :2.000                 
 Mean   :2024-09-24   Mean   :2.123                 
 3rd Qu.:2024-10-02   3rd Qu.:3.000                 
 Max.   :2024-10-06   Max.   :5.000                 
 NA's   :61           NA's   :18                    
 how_many_people_did_you_infect date_of_first_exposure time_of_first_exposure
 Min.   :0.000                  Min.   :2024-09-10     Length:91             
 1st Qu.:0.000                  1st Qu.:2024-09-20     Class :character      
 Median :1.000                  Median :2024-09-30     Mode  :character      
 Mean   :0.989                  Mean   :2024-09-27                           
 3rd Qu.:2.000                  3rd Qu.:2024-10-02                           
 Max.   :4.000                  Max.   :2024-10-18                           
                                NA's   :23                                   
 date_of_second_exposure time_of_second_exposure date_of_third_exposure
 Min.   :2024-09-11      Length:91               Min.   :2024-09-13    
 1st Qu.:2024-09-15      Class :character        1st Qu.:2024-09-20    
 Median :2024-09-27      Mode  :character        Median :2024-09-30    
 Mean   :2024-09-25                              Mean   :2024-09-27    
 3rd Qu.:2024-10-02                              3rd Qu.:2024-10-03    
 Max.   :2024-10-18                              Max.   :2024-10-18    
 NA's   :47                                      NA's   :68            
 time_of_third_exposure date_of_fourth_exposure time_of_fourth_exposure
 Length:91              Min.   :2024-09-20      Length:91              
 Class :character       1st Qu.:2024-09-26      Class :character       
 Mode  :character       Median :2024-09-30      Mode  :character       
                        Mean   :2024-09-30                             
                        3rd Qu.:2024-10-03                             
                        Max.   :2024-10-23                             
                        NA's   :79                                     
 date_of_fifth_exposure time_of_fifth_exposure date_time_first_exposure
 Min.   :2024-09-23     Length:91              Length:91               
 1st Qu.:2024-09-28     Class :character       Class :character        
 Median :2024-09-30     Mode  :character       Mode  :character        
 Mean   :2024-10-02                                                    
 3rd Qu.:2024-10-04                                                    
 Max.   :2024-10-16                                                    
 NA's   :87                                                            
 date_time_second_exposure date_time_third_exposure date_time_fourth_exposure
 Length:91                 Length:91                Length:91                
 Class :character          Class :character         Class :character         
 Mode  :character          Mode  :character         Mode  :character         
                                                                             
                                                                             
                                                                             
                                                                             
 date_time_fifth_exposure
 Length:91               
 Class :character        
 Mode  :character        
                         
                         
                         
                         </code></pre>
</div>
</div>
</section>
<section id="math-model-compartmental-seir" class="level2">
<h2 class="anchored" data-anchor-id="math-model-compartmental-seir">Math Model: Compartmental SEIR</h2>
<section id="calculate" class="level3">
<h3 class="anchored" data-anchor-id="calculate">Calculate:</h3>
<section id="sigma-gamma" class="level4">
<h4 class="anchored" data-anchor-id="sigma-gamma">Sigma &amp; Gamma</h4>
</section>
<section id="sigma-exposed---infectious" class="level4">
<h4 class="anchored" data-anchor-id="sigma-exposed---infectious">Sigma: Exposed -&gt; Infectious</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure date_time_exposure is in POSIXct format</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>date_time_exposure <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(rff<span class="sc">$</span>date_time_exposure)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure how_many_hours_after_exposure_did_you_develop_symptoms is numeric</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>how_many_hours_after_exposure_did_you_develop_symptoms <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rff<span class="sc">$</span>how_many_hours_after_exposure_did_you_develop_symptoms)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the datetime of symptoms onset</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>date_time_symptoms <span class="ot">&lt;-</span> rff<span class="sc">$</span>date_time_exposure <span class="sc">+</span> <span class="fu">dhours</span>(rff<span class="sc">$</span>how_many_hours_after_exposure_did_you_develop_symptoms)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the incubation period in hours</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>incubation_period_hours <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(rff<span class="sc">$</span>date_time_symptoms, rff<span class="sc">$</span>date_time_exposure, <span class="at">units =</span> <span class="st">"hours"</span>))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert incubation period to days</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>incubation_period_days <span class="ot">&lt;-</span> rff<span class="sc">$</span>incubation_period_hours <span class="sc">/</span> <span class="dv">24</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average incubation period in days</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>average_incubation_period_days <span class="ot">&lt;-</span> <span class="fu">mean</span>(rff<span class="sc">$</span>incubation_period_days, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate sigma (rate of progression from exposed to infectious per day)</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> average_incubation_period_days</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sigma</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9725036</code></pre>
</div>
</div>
</section>
<section id="gamma-infectious---recovered" class="level4">
<h4 class="anchored" data-anchor-id="gamma-infectious---recovered">Gamma: Infectious -/&gt; Recovered</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate gamma parameter rate of recovery from infectious to recovered per day 1/duration</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the datetime of feeling better</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>date_time_feel_better <span class="ot">&lt;-</span> rff<span class="sc">$</span>date_time_symptoms <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dhours</span>(rff<span class="sc">$</span>how_many_hours_after_your_symptom_onset_did_you_feel_better)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the duration of infectiousness in hours</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>rff<span class="sc">$</span>duration_of_infectiousness <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(rff<span class="sc">$</span>date_time_feel_better, rff<span class="sc">$</span>date_time_symptoms, <span class="at">units =</span> <span class="st">"hours"</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Average Duration of Infectiousness</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>duration_of_infectiousness_h <span class="ot">&lt;-</span> <span class="fu">mean</span>(rff<span class="sc">$</span>duration_of_infectiousness, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (duration_of_infectiousness_h <span class="sc">/</span> <span class="dv">24</span>)  <span class="co"># Convert to days</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gamma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9180328</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Beta Parameter daily effective contacts (beta*alpha)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Beta <span class="ot">&lt;-</span> rff <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(infectedby, date_of_exposure) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">contacts =</span> <span class="fu">n_distinct</span>(case_id), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Beta<span class="sc">$</span>contacts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.444444</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define model parameters</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta =</span> <span class="fl">1.444</span>,   <span class="co"># beta = daily effective contacts (alpha*beta)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span> <span class="fl">0.973</span>,  <span class="co"># sigma = rate of exposed to infectious per day</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">gamma =</span> <span class="fl">0.918</span>,  <span class="co"># gamma = rate of recovery from infectious to recovered per day</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">mu =</span> <span class="fl">0.0</span>,       <span class="co"># mu = per capita birth and death rate</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">omega =</span> <span class="fl">0.0</span>)     <span class="co"># omega = rate of immune loss per day</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial conditions</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">90</span>,           <span class="co"># number initially susceptible</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">E =</span> <span class="dv">0</span>,            <span class="co"># number initially exposed</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">I =</span> <span class="dv">1</span>,            <span class="co"># number initially infectious</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">R =</span> <span class="dv">0</span>)            <span class="co"># initially immune or "recovered"</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define SEIR model equations</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>seir_ode <span class="ot">&lt;-</span> <span class="cf">function</span>(times, init, parms) {</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(parms, init)), {</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    dS <span class="ot">&lt;-</span> mu <span class="sc">*</span> (S <span class="sc">+</span> E <span class="sc">+</span> I <span class="sc">+</span> R) <span class="sc">+</span> omega <span class="sc">*</span> R <span class="sc">-</span> beta <span class="sc">*</span> I <span class="sc">*</span> S <span class="sc">/</span> (S <span class="sc">+</span> E <span class="sc">+</span> I <span class="sc">+</span> R) <span class="sc">-</span> mu <span class="sc">*</span> S</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    dE <span class="ot">&lt;-</span> beta <span class="sc">*</span> I <span class="sc">*</span> S <span class="sc">/</span> (S <span class="sc">+</span> E <span class="sc">+</span> I <span class="sc">+</span> R) <span class="sc">-</span> sigma <span class="sc">*</span> E <span class="sc">-</span> mu <span class="sc">*</span> E</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    dI <span class="ot">&lt;-</span> sigma <span class="sc">*</span> E <span class="sc">-</span> gamma <span class="sc">*</span> I <span class="sc">-</span> mu <span class="sc">*</span> I</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    dR <span class="ot">&lt;-</span> gamma <span class="sc">*</span> I <span class="sc">-</span> omega <span class="sc">*</span> R <span class="sc">-</span> mu <span class="sc">*</span> R</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(dS, dE, dI, dR))</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Model time and solution</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>seir_out <span class="ot">&lt;-</span> <span class="fu">lsoda</span>(init, times, seir_ode, parms)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>seir_out_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">as.data.frame</span>(seir_out), <span class="st">"time"</span>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the SEIR model output</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>SEIR <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(seir_out_long, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> value, <span class="at">colour =</span> variable, <span class="at">group =</span> variable)) <span class="sc">+</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Number"</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the SEIR plot as a PNG image</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"SEIR.png"</span>, <span class="at">plot =</span> SEIR, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Include the plot in the Quarto document</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"SEIR.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SEIR.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>